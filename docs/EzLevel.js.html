<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    
    
    <meta name="author" content="retrouser955" />
    
    <meta name="description" content="A complete framework to implement a leveling system using discord.js v13" />
    
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      EzLevel.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Discord Easy Leveling</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="726091" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=5110690><div class="accordion-heading child"><a href="EasyLeveling.html">EasyLeveling</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="EasyLeveling.html#addLevels">addLevels</a></li><li data-type='method'><a href="EasyLeveling.html#deleteUserData">deleteUserData</a></li><li data-type='method'><a href="EasyLeveling.html#generateXPChart">generateXPChart</a></li><li data-type='method'><a href="EasyLeveling.html#getAllData">getAllData</a></li><li data-type='method'><a href="EasyLeveling.html#getTopUser">getTopUser</a></li><li data-type='method'><a href="EasyLeveling.html#getUserLevel">getUserLevel</a></li><li data-type='method'><a href="EasyLeveling.html#reduceLevels">reduceLevels</a></li><li data-type='method'><a href="EasyLeveling.html#reduceXP">reduceXP</a></li><li data-type='method'><a href="EasyLeveling.html#setLevel">setLevel</a></li><li data-type='method'><a href="EasyLeveling.html#setXP">setXP</a></li></ul></li></ul> </div><div class="accordion collapsed" id="8546076" > <h3 class="accordion-heading">Tutorials<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="tutorial-Graph Tutorial.html">Graph Tutorial</a></li></ul> </div><div class="accordion collapsed" id="4362313" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#AllData">AllData</a></li><li class="accordion-list" id=""><a href="global.html#Database">Database</a></li><li class="accordion-list" id=""><a href="global.html#DiscordEasyLevelingOptions">DiscordEasyLevelingOptions</a></li><li class="accordion-list" id=""><a href="global.html#UserDataObject">UserDataObject</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        EzLevel.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Options for discord easy leveling
 * @typedef {object} DiscordEasyLevelingOptions
 * @property {string} startingXP The amount of XP you want to user to start with
 * @property {string} startingLevel The level you want the user to start with
 * @property {string} levelUpXP The amount of XP need to level up a user
 * @property {string} database The database you want. This can be json or sqlite
 */
/**
 * @typedef {object} UserDataObject
 * @property {number} XPoverTime Amount of XP a user has aquired overtime
 * @property {string} userId Id of the user
 * @property {number} level Current level of a user
 * @property {number} xp Current XP of a user
 */
/**
 * Array of objects containing all users data
 * @typedef {array&lt;object>} AllData
 * @property {string} ID the id of the data
 * @property {UserDataObject} UserData The data of a user
 */
/**
 * @author retrouser955
 * @see &lt;a href="https://github.com/retrouser955">Retro github&lt;/a>
 */
const Database = require('easy-json-database')
const { EventEmitter } = require("events")
const events = require('./events/events.js')
const deleteModule = require('./deletedb.js')
const generateChartImage = require('./xpChart.js')
class EasyLeveling extends EventEmitter {
    /**
     * Create a new Discord Easy Level
     * @param {any} client Your Discord.js Client
     * @param {DiscordEasyLevelingOptions} options Discord XP level options
     */
    constructor(client, options) {
        super()
        if(!client) throw new Error('Easy Leveling Error: A valid discord client must be provided')
        if(!options) throw new Error('Easy Leveling Error: Options must be defined. Consinder reading readme.md')
        if(typeof options != 'object') throw new Error('Easy Leveling Error: Typeof options must be an object')
        // if(!options.startingXP || !options.startingLevel || !options.levelUpXP || !options.database) throw new Error('Easy Leveling Error: starting XP, starting Level or level up XP must be defined')
        this.client = client
        this.startingXP = options.startingXP || 1
        this.startingLevel = options.startingLevel || 1
        this.levelUpXP = options.levelUpXP || 100
        if(options.database == 'json') {
            this.db = new Database('./EasyLeveling.json')
	        this.dbName = 'json'
        } else if(options.database == 'sqlite') {
            this.db = require('quick.db')
	        this.dbName = 'sqlite'
        } else {
            throw new Error("Easy Leveling Error: Database must be an option between a 'json' databse and a 'sqlite' database")
        }
        process.on('uncaughtException', (err) => {
            this.emit(events.error, err, undefined)
        })
    }
    /**
     * add level to your desire user
     * @param {string} userId The id of the user you want to add levels
     * @param {string} guildId The id of the guild that the user is in
     */
    async addLevels(userId, guildId, channelId) {
        if(!userId) throw new Error('Easy Leveling Error: A valid user id must be provided')
        if(!guildId) throw new Error('Easy Level Error: A valid guild id must be provided')
        if(!channelId) throw new Error('Easy Level Error: A valid channel id must be provided')
        try {
            const dbHasLevel = this.db.has(`${userId}-${guildId}`)
            if(!dbHasLevel) {
                this.db.set(`${userId}-${guildId}`, { XP: this.startingXP })
                this.db.set(`${userId}-${guildId}.level`, this.startingLevel)
                this.db.set(`${userId}-${guildId}.userId`, userId)
                this.db.set(`${userId}-${guildId}.XPoverTime`, 1)
                return
            }
            const userLevelUp = await this.db.get(`${userId}-${guildId}.XP`)
            if(userLevelUp == this.levelUpXP) {
                await this.db.set(`${userId}-${guildId}.XP`, 0)
                const userHasLevel = this.db.has(`${userId}-${guildId}.level`)
                if(!userHasLevel) return await this.db.set(`${userId}-${guildId}.level`, 1)
                if(this.dbName == 'json') {
                    const newLevel = userLevelUp + 1
                    this.db.set(`${userId}-${guildId}.level`, newLevel)
                } else {
                    await this.db.add(`${userId}-${guildId}.level`, 1)
                }
                const newLevel = this.db.get(`${userId}-${guildId}.level`)
                const lastLevel = newLevel - 1
                this.emit(events.UserLevelUpEvent, newLevel, lastLevel, userId, guildId, channelId)
                return
            }
            if(this.dbName == 'json') {
                const currectData = await this.db.get(`${userId}-${guildId}.XP`)
                const XPoverTime = await this.db.get(`${userId}-${guildId}.XPoverTime`)
                const newXPoverTime = XPoverTime + 1
                const newData = currectData + 1
                await this.db.set(`${userId}-${guildId}.XP`, newData)
                await this.db.set(`${userId}-${guildId}.XPoverTime`, newXPoverTime)
                return
            }
            this.db.add(`${userId}-${guildId}.XP`, 1)
            this.db.add(`${userId}-${guildId}.XPoverTime`, 1)
        } catch (error) {
            this.emit(events.error, error, 'addLevels')
        }
    }
    /**
     * get the level and xp of the user
     * @param {string} userId user id
     * @param {string} guildId guild id
     * @returns {object} XP and the level of the user
     */
    async getUserLevel(userId, guildId) {
        if(!userId) throw new Error('Easy Level Error: A valid user id must be provided')
        if(!guildId) throw new Error('Easy Level Error: A valid guild id must be provided')
        try {
            const level = await this.db.get(`${userId}-${guildId}.level`)
            const xp = await this.db.get(`${userId}-${guildId}.XP`)
            const data = {
                level: level,
                xp: xp
            }
            return data
        } catch (error) {
            this.emit(events.error, error, 'getUserLevel')
        }
    }
    /**
     * force set the level of a user
     * @param {number} level amount of level you want the author to have
     * @param {string} userId user id of the user you want to set level to
     * @param {string} guildId the discord guild you want the level to be set in
     */
    async setLevel(level, userId, guildId) {
        if(!level) throw new Error('Easy Level Error: A valid level must be provided')
        if(typeof level != "number") throw new SyntaxError('Easy Level Error: Type of level must be a number')
        if(!userId) throw new Error('Easy Level Error: A valid user id must be provided')
        if(!guildId) throw new Error('Easy Level Error: A valid guild id must be provided')
        try {
            await this.db.set(`${userId}-${guildId}.level`, level) 
        } catch (error) {
            this.emit(events.error, error, 'setLevel')
        }
    }
    /**
     * force set the xp of a user
     * @param {string} xp amount of XP you want the author to have
     * @param {string} userId user id of the user you want to set XP to
     * @param {string} guildId the discord guild you want the XP to be set in
     */
    async setXP(xp, userId, guildId) {
        if(!xp) throw new Error('Easy Level Error: A valid xp must be provided')
        if(typeof xp != 'number') throw new SyntaxError('Easy Level Error: Type of xp must be a number')
        if(xp > this.levelUpXP) throw new Error(`Easy Level Error: Amount of XP cannot be more than ${this.levelUpXP}`)
        if(xp &lt; 0) throw new Error(`Easy Level Error: Amount of XP cannot be more than 0`)
        try {
            await this.db.set(`${userId}-${guildId}.XP`, xp)
        } catch (error) {
            this.emit(events.error, error, 'setXP')
        }
    }
    /**
     * get all data from the database. powered by quick.db
     * @returns {AllData}
     */
    async getAllData() {
        try {
            const allData = this.db.all()
            return allData
        } catch (error) {
            this.emit(events.error, error, 'getAllData')
        }
    }
    async deleteAllData() {
        deleteModule.deleteAllData(this.db, this.dbName)
    }
    /**
     * will delete a user's data from the database
     * @param {string} userId the id of the user you want to delete
     * @param {string} guildId the id of the guild you want the data deleted from
     */
    async deleteUserData(userId, guildId) {
        if(!userId) throw new Error('Easy Level Error: A valid user id must be provided!')
        if(!guildId) throw new Error('Easy Level Error: A valid user guild must be provided!')
        try {
            deleteModule.deleteUserData(userId, guildId, this.db)
        } catch(err) {
            this.emit(events.error, error, 'deleteUserData')
        }
    }
    /**
     * Reduce the amount of level(s) from a user
     * @param {string} userId Id of the user you want to reduce levels from
     * @param {string} guildId Id of the guild you want to reduce Levels from
     * @param {number} amount Amount of levels you want to reduce
     */
    async reduceLevels(userId, guildId, amount) {
        if(!userId) throw new Error('Easy Level Error: A valid user id must be provided!')
        if(!guildId) throw new Error('Easy Level Error: A valid user guild must be provided!')
        if(!amount) throw new Error('Easy Level Error: An amount must be provided!')
        if(typeof amount != 'number') throw new Error("Easy Level TypeError: Type of 'amount' must be a number")
        try {
            const xpAmount = amount * 100
            if(this.dbName == 'json') {
                const currectData = await this.db.get(`${userId}-${guildId}.level`)
                const newData = currectData - amount
                const XPoverTime = await this.db.get(`${userId}-${guildId}.XPoverTime`)
                const newXPoverTime = XPoverTime - xpAmount
                this.db.set(`${userId}-${guildId}.level`, newData)
                this.db.set(`${userId}-${guildId}.XPoverTime`, newXPoverTime)
                return
            }
            this.db.subtract(`${userId}-${guildId}.level`, amount)
            this.db.subtract(`${userId}-${guildId}.XPoverTime`, xpAmount)
        } catch (error) {
            this.emit(events.error, error, 'reduceLevels')
        }
    }
    /**
     * reduce the amount of xp(s) from a user
     * @param {string} userId Id of the user you want to reduce xp from
     * @param {string} guildId Id of the guild you want to reduce xp from
     * @param {number} amount Amount of xp(s) you want to reduce
     */
    async reduceXP(userId, guildId, amount) {
        if(!userId) throw new Error('Easy Level Error: A valid user id must be provided!')
        if(!guildId) throw new Error('Easy Level Error: A valid user guild must be provided!')
        if(!amount) throw new Error('Easy Level Error: An amount must be provided!')
        try {
            if(typeof amount != 'number') throw new Error("Easy Level TypeError: Type of 'amount' must be a number")
            if(this.dbName == 'json') {
                const currectData = await this.db.get(`${userId}-${guildId}.XP`)
                const newData = currectData - amount
                const XPoverTime = await this.db.get(`${userId}-${guildId}.XPoverTime`)
                const newXPoverTime = XPoverTime - amount
                this.db.set(`${userId}-${guildId}.XP`, newData)
                this.db.set(`${userId}-${guildId}.XPoverTime`, newXPoverTime)
                return
            }
            this.db.subtract(`${userId}-${guildId}.XPoverTime`, amount)
            this.db.subtract(`${userId}-${guildId}.XP`, amount) 
        } catch (error) {
            this.emit(events.error, error, 'reduceXP')
        }
    }
    /**
     * get the top users of a guild
     * @param {string} guildId The guild id of the top users
     * @param {number} amountOfUsers Amount of people in the array
     * @returns {array} top users 
     */
    async getTopUser(guildId, amountOfUsers) {
        if(!guildId) throw new Error('Easy level Error: guildId must be a valid discord guild')
        if(!amountOfUsers) throw new Error('Easy level Error: Amount of users must defined')
        if(typeof amountOfUsers != 'number') throw new TypeError('Easy Level TypeError: Type of \'amount of users\' must be a number')
        if(this.dbName == 'json') {
            const allData = await this.db.all()
            const XPforGuild = []
            for(const key of allData) {
                if(String(key.key).includes(guildId)) {
                    XPforGuild.push({
                        xpOverTime: key.data.XPoverTime,
                        userId: key.data.userId,
                        level: key.data.level,
                        xp: key.data.XP
                    })
                }
            }
            XPforGuild.sort((a, b) => {
                return b.xpOverTime - a.xpOverTime
            })
            let top10 = []
            for(let i = 0; i &lt; amountOfUsers; i++) {
                top10.push(XPforGuild[i])
            }
            return top10
        }
        const allData = await this.db.all()
        const XPforGuild = []
        for(const key of allData) {
            if(String(key.ID).includes(guildId)) {
                XPforGuild.push({
                    xpOverTime: key.data.XPoverTime,
                    userId: key.data.userId,
                    level: key.data.level,
                    xp: key.data.XP
                })
            }
        }
        XPforGuild.sort((a, b) => {
            return b.xpOverTime - a.xpOverTime
        })
        let top10 = []
        for(let i = 0; i &lt; amountOfUsers; i++) {
            top10.push(XPforGuild[i])
        }
        return top10
    }
    /**
     * Generate a chart of the XP usage in a guild
     * @param {string} guildId the id of a discord guild you want the chart to generate
     * @param {number} amountOfUsers amount of users in a chart (do not set it higher than 5)
     * @returns {BufferEncoding} Image of a chart buffered
     */
    async generateXPChart(guildId, amountOfUsers) {
        if(!guildId) throw new Error('Easy Level Error: A valid discord guild must be provided')
        if(!amountOfUsers) throw new Error('Easy level Error: Amount of users must defined')
        if(typeof amountOfUsers != 'number') throw new TypeError('Easy Level TypeError: Type of \'amount of users\' must be a number')
        const bufferedChart = generateChartImage(this.dbName, this.db, amountOfUsers, guildId, this.client)
        return bufferedChart
    }
}
module.exports = EasyLeveling</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"EasyLeveling","link":"<a href=\"EasyLeveling.html\">EasyLeveling</a>"},{"title":"EasyLeveling#addLevels","link":"<a href=\"EasyLeveling.html#addLevels\">EasyLeveling &rtrif; addLevels</a>"},{"title":"EasyLeveling#deleteUserData","link":"<a href=\"EasyLeveling.html#deleteUserData\">EasyLeveling &rtrif; deleteUserData</a>"},{"title":"EasyLeveling#generateXPChart","link":"<a href=\"EasyLeveling.html#generateXPChart\">EasyLeveling &rtrif; generateXPChart</a>"},{"title":"EasyLeveling#getAllData","link":"<a href=\"EasyLeveling.html#getAllData\">EasyLeveling &rtrif; getAllData</a>"},{"title":"EasyLeveling#getTopUser","link":"<a href=\"EasyLeveling.html#getTopUser\">EasyLeveling &rtrif; getTopUser</a>"},{"title":"EasyLeveling#getUserLevel","link":"<a href=\"EasyLeveling.html#getUserLevel\">EasyLeveling &rtrif; getUserLevel</a>"},{"title":"EasyLeveling#reduceLevels","link":"<a href=\"EasyLeveling.html#reduceLevels\">EasyLeveling &rtrif; reduceLevels</a>"},{"title":"EasyLeveling#reduceXP","link":"<a href=\"EasyLeveling.html#reduceXP\">EasyLeveling &rtrif; reduceXP</a>"},{"title":"EasyLeveling#setLevel","link":"<a href=\"EasyLeveling.html#setLevel\">EasyLeveling &rtrif; setLevel</a>"},{"title":"EasyLeveling#setXP","link":"<a href=\"EasyLeveling.html#setXP\">EasyLeveling &rtrif; setXP</a>"},{"title":"Graph Tutorial","link":"Graph Tutorial"},{"title":"AllData","link":"<a href=\"global.html#AllData\">AllData</a>"},{"title":"Database","link":"<a href=\"global.html#Database\">Database</a>"},{"title":"DiscordEasyLevelingOptions","link":"<a href=\"global.html#DiscordEasyLevelingOptions\">DiscordEasyLevelingOptions</a>"},{"title":"UserDataObject","link":"<a href=\"global.html#UserDataObject\">UserDataObject</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
